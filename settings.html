<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Settings - ThinkBigPrep</title>
    <link rel="shortcut icon" href="assets/logo/thinkbigprep-icon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="css/index.css?v=1.1" />
    <link rel="stylesheet" href="css/login.css?v=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" />
    <style>
      .header .logo img{height:48px;width:auto}
      .settings-wrap{width:min(96vw, 1000px);min-height:calc(100vh - 220px);margin:120px auto 0;padding:0 20px 80px}
      .settings-title{font-size:1.8rem;font-weight:800;color:#1a1a1a;margin:0}
      .settings-sub{color:#6b6b6b;margin:6px 0 0}
      .settings-card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;max-width:640px;margin:0 auto;min-height:800px}
      .settings-head{padding:16px 16px;border-bottom:1px solid #f0f0f0}
      .settings-list{display:flex;flex-direction:column}
      .setting-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #f0f0f0}
      .setting-row:last-child{border-bottom:none}
      .setting-label{color:#1a1a1a;font-weight:600;margin-right:12px}
      .switch{position:relative;display:inline-block;width:48px;height:28px}
      .switch input{opacity:0;width:0;height:0}
      .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#e5e7eb;transition:.2s;border-radius:9999px;border:1px solid #d6d6d6}
      .slider:before{position:absolute;content:"";height:22px;width:22px;left:3px;top:2px;background:#fff;transition:.2s;border-radius:50%;box-shadow:0 1px 2px rgba(0,0,0,.12)}
      .switch input:checked + .slider{background:#8B4513;border-color:#8B4513}
      .switch input:checked + .slider:before{transform:translateX(20px)}
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-container">
        <a href="index.html#home" class="logo" style="text-decoration:none;color:inherit;"><img src="./assets/logo/thinkbigprep-logo.svg" alt="ThinkBigPrep"/></a>
        <nav class="nav-desktop">
          <a href="index.html#home">Home</a>
          <a href="timetable.html">Timetable</a>
          <a href="index.html#courses">Plans</a>
          <a href="index.html#coaches">Available Tutors</a>
          <a href="about.html">About Us</a>
          <a href="jarvis.html">Jarvis</a>
          <a href="ai-curriculum.html">AI Curriculum</a>
          <a href="problem-sets.html">Think Lab <span class="new-tag">NEW</span></a>
          <a href="login.html" class="student-login-link">Student Login</a>
        </nav>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()"><i class="bi bi-list"></i></button>
      </div>
    </header>

    <main class="settings-wrap">
      <section class="settings-card" aria-labelledby="settingsList">
        <div class="settings-head">
          <h1 class="settings-title">Settings</h1>
          <p class="settings-sub">Manage your notifications and communications preferences.</p>
        </div>
        <div class="settings-list" id="settingsList">
          <div class="setting-row">
            <span class="setting-label">School</span>
            <select id="settingsSchool" style="flex:1;margin-left:12px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;background:#fff">
              <option value="">Select school</option>
            </select>
          </div>
          <div class="setting-row">
            <span class="setting-label">Receive email from ThinkBigPrep</span>
            <label class="switch"><input type="checkbox" id="sEmail"><span class="slider"></span></label>
          </div>
          <div class="setting-row">
            <span class="setting-label">Receive text messages from ThinkBigPrep</span>
            <label class="switch"><input type="checkbox" id="sSms"><span class="slider"></span></label>
          </div>
          <div class="setting-row">
            <span class="setting-label">Really big announcements</span>
            <label class="switch"><input type="checkbox" id="sAnnouncements"><span class="slider"></span></label>
          </div>
          <div class="setting-row">
            <span class="setting-label">ThinkBigPrep Newsletters</span>
            <label class="switch"><input type="checkbox" id="sNewsletters"><span class="slider"></span></label>
          </div>
          <div class="setting-row">
            <span class="setting-label">Donations</span>
            <label class="switch"><input type="checkbox" id="sDonations"><span class="slider"></span></label>
          </div>
          <div class="setting-row">
            <span class="setting-label">Notifications related to streaks</span>
            <label class="switch"><input type="checkbox" id="sStreaks"><span class="slider"></span></label>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <div class="footer-logo"><img src="./assets/logo/thinkbigprep-logo.svg" alt="ThinkBigPrep"/><span>ThinkBigPrep</span></div>
          </div>
          <div class="footer-section">
            <h4>SEE ALSO</h4>
            <ul>
              <li><a href="index.html#home">Home</a></li>
              <li><a href="timetable.html">Timetable</a></li>
              <li><a href="ai-curriculum.html">AI Curriculum</a></li>
              <li><a href="problem-sets.html">Think Lab</a></li>
            </ul>
          </div>
          <div class="footer-section"><h4>CONTACT US</h4><p>Phone: 201-665-0123</p><p>Email: info@thinkbigprep.com</p></div>
        </div>
        <div class="footer-bottom"><p>ThinkBigPrep Â© 2025</p></div>
      </div>
    </footer>

    <script>window.TBP_AUTH_BASE='https://cramprep.onrender.com';</script>
    <script src="index.js"></script>
    <script src="login.js?v=1.0"></script>
    <script>
      (function(){
        const keys = {
          sEmail:'tbp_set_email', sSms:'tbp_set_sms', sAnnouncements:'tbp_set_ann',
          sNewsletters:'tbp_set_news', sDonations:'tbp_set_donate', sStreaks:'tbp_set_streaks'
        };
        const base = (window.TBP_AUTH_BASE || '').replace(/\/$/, '');
        let token = '';
        try { token = localStorage.getItem('tbp_token') || ''; } catch {}
        const schoolSelect = document.getElementById('settingsSchool');

        async function fetchProfile(){
          if (!token) return null;
          try {
            const res = await fetch(`${base}/auth/profile`, { headers: { 'Authorization': `Bearer ${token}` } });
            const data = await res.json().catch(() => ({}));
            if (!res.ok || !data || !data.profile) return null;
            return data.profile;
          } catch { return null; }
        }

        async function saveSchool(value){
          if (!token) return;
          try {
            await fetch(`${base}/auth/profile`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
              body: JSON.stringify({ school: value || null })
            });
          } catch (err) { console.warn('Failed to save school', err); }
        }

        async function loadSchoolOptions(){
          if (!schoolSelect) return;
          let schools = [];
          try {
            const res = await fetch(`${base}/ai/schools`);
            const data = await res.json().catch(() => ({}));
            if (res.ok && data && Array.isArray(data.schools)) schools = data.schools;
          } catch { schools = []; }
          schoolSelect.innerHTML = '<option value="">Select school</option>';
          schools.forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            schoolSelect.appendChild(opt);
          });

          if (!token){
            schoolSelect.disabled = true;
            return;
          }
          schoolSelect.disabled = false;
          const profile = await fetchProfile();
          if (profile && profile.school){
            const existing = schoolSelect.querySelector(`option[value="${CSS.escape(profile.school)}"]`);
            if (!existing){
              const opt = document.createElement('option');
              opt.value = profile.school;
              opt.textContent = profile.school;
              schoolSelect.appendChild(opt);
            }
            schoolSelect.value = profile.school;
          }
          if (!schoolSelect.dataset.bound){
            schoolSelect.addEventListener('change', () => { saveSchool(schoolSelect.value); });
            schoolSelect.dataset.bound = '1';
          }
        }
        function get(k){
          try{
            const v = localStorage.getItem(k);
            if (v === null){ localStorage.setItem(k,'1'); return true; }
            return v === '1';
          } catch{ return true; }
        }
        function set(k,v){ try{ localStorage.setItem(k, v?'1':'0'); }catch{} }
        Object.keys(keys).forEach(id=>{
          const el = document.getElementById(id);
          if (!el) return;
          el.checked = get(keys[id]);
          el.addEventListener('change', ()=> set(keys[id], el.checked));
        });
        loadSchoolOptions();
        window.addEventListener('tbp:auth:login', () => {
          try { token = localStorage.getItem('tbp_token') || ''; } catch { token = ''; }
          loadSchoolOptions();
        });
        window.addEventListener('storage', (e) => {
          if (e && e.key === 'tbp_token'){
            try { token = localStorage.getItem('tbp_token') || ''; } catch { token = ''; }
            loadSchoolOptions();
          }
        });
      })();
    </script>
  </body>
  </html>


